<div class="fake-title-container"></div>
<div class="title-container">
  <h1 class="title">{{ 'service.notification.title' | translate }}</h1>
</div>

<div class="row card-row" *ngIf="devicesData">
  <div class="col-auto custom-card" *ngIf="devicesData.data" [class.active-card]="activeFilters.isRS" (click)="activeFilters.isRS = !activeFilters.isRS" matRipple>
    <h3 class="card-title">{{ 'service.notification.regular_service' | translate }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-6 p-0 pr-2" style="text-align: center;">
        <span class="card-number">{{devicesData.data.length}}</span>
      </div>
      <div class="col-3 card-data-col" style="text-align: center;">
        <span class="card-data-number red-text">{{getWarrantyCount(0) + getWarrantyCount(1)}}</span>
        <br>
        <img src="/assets/notifications/shell_full.svg" alt="">
      </div>
      <div class="col-3 card-data-col" style="text-align: center;">
        <span class="card-data-number blue-text">{{getWarrantyCount(2)}}</span>
        <br>
        <img src="/assets/notifications/shell_border.svg" alt="">
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="">
      <span class="card-bottom-time">{{ 'service.notification.7_days' | translate }}</span>
    </div>
  </div>

  <div class="col-auto custom-card" *ngIf="allDataCounts" [class.active-card]="activeFilters.onlineService"
       (click)="activeFilters.onlineService = !activeFilters.onlineService" matRipple>
    <h3 class="card-title">{{ 'service.notification.booked' | translate }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-6 p-0" style="text-align: center;">
        <span class="card-number">{{findDataCount('orders', 9).count}}</span>
      </div>
      <div class="col-3 card-data-col" style="text-align: center;">
        <span class="card-data-number green-text">{{findDataCount('orders', 9).count}}</span>
        <br>
        <img src="/assets/notifications/planet.png" alt="">
      </div>
      <div class="col-3 card-data-col" style="text-align: center;">
        <span class="card-data-number brown-text">{{0}}</span>
        <br>
        <img src="/assets/notifications/table.png" alt="">
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="">
<!--      <span class="card-bottom-time">2 days</span>-->
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isWE" (click)="activeFilters.isWE = !activeFilters.isWE" matRipple>
    <h3 class="card-title">{{ 'service.notification.expiration' | translate }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{getWarrantyCount(1)}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('WE')">
<!--      <span class="card-bottom-time">30 days</span>-->
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isUE" (click)="activeFilters.isUE = !activeFilters.isUE" matRipple>
    <h3 class="card-title">{{ 'service.notification.erros' | translate }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{getErrorsCount()}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('UE')">
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isTP" (click)="activeFilters.isTP = !activeFilters.isTP" matRipple>
    <h3 class="card-title">{{ 'service.notification.pressure' | translate }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{countErrors(false, getConfig('TP', 'max'), 'TP')}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('TP')">
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isCL" (click)="activeFilters.isCL = !activeFilters.isCL" matRipple>
    <h3 class="card-title">{{ 'service.notification.liquid' | translate  }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{countErrors(false, getConfig('CL', 'max'), 'CL')}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('CL')">
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isOL" (click)="activeFilters.isOL = !activeFilters.isOL" matRipple>
    <h3 class="card-title">{{ 'service.notification.oil' | translate  }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{countErrors(false, getConfig('OL', 'max'), 'OL')}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('OL')">
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isFL" (click)="activeFilters.isFL = !activeFilters.isFL" matRipple>
    <h3 class="card-title">{{ 'service.notification.fuel' | translate  }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{countErrors(false, getConfig('FL', 'max'), 'FL')}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('FL')">
    </div>
  </div>

  <div class="col-auto custom-card" [class.active-card]="activeFilters.isBV" (click)="activeFilters.isBV = !activeFilters.isBV" matRipple>
    <h3 class="card-title">{{ 'service.notification.battary' | translate  }}</h3>

    <div class="row" style="margin: 0;">
      <div class="col-12 p-0" style="text-align: center;">
        <span class="card-number">{{countErrors(true, getConfig('BV', 'min'), 'BV')}}</span>
      </div>
    </div>

    <div class="card-bottom">
      <img src="/assets/notifications/arrow_more.svg" class="card-bottom-arrow" alt="" (click)="clearFilters('BV')">
    </div>
  </div>

<!--  <div class="col-auto p-1">-->
<!--    <img src="/assets/settings.png" alt="" [matMenuTriggerFor]="topCardsMore">-->

<!--    <mat-menu #topCardsMore="matMenu">-->
<!--      <button mat-menu-item>Show infotiles</button>-->
<!--      <button mat-menu-item>Hide infotiles</button>-->
<!--      <button mat-menu-item>Edit infotiles</button>-->
<!--    </mat-menu>-->
<!--  </div>-->
</div>

<div style="padding: 2px 34px;" class="container-fluid">
  <div class="row">
    <!--  <button mat-button [matMenuTriggerFor]="viewMenu">-->
    <!--    View-->
    <!--    <mat-icon>-->
    <!--      <img src="/assets/notifications/arrow_more.svg" alt="">-->
    <!--    </mat-icon>-->

    <!--    <mat-menu #viewMenu="matMenu" class="rounded-0">-->
    <!--      <button mat-menu-item>About this record</button>-->
    <!--      <button mat-menu-item [matMenuTriggerFor]="columns">Columns</button>-->
    <!--    </mat-menu>-->

    <!--    <mat-menu #columns="matMenu" class="rounded-0">-->

    <!--    </mat-menu>-->
    <!--  </button>-->
    <div class="pr-0 col-auto">
      <button class="pr-4 button-action" mat-button [matMenuTriggerFor]="actionMenu">
        {{ 'service.buttons.action' | translate  }}
        <mat-icon style="position: absolute; top: 8px;">
          <img src="/assets/notifications/arrow_more.svg" alt="">
        </mat-icon>

        <mat-menu #actionMenu="matMenu" class="rounded-0">
          <button mat-menu-item (click)="dismiss()">{{ 'service.notification.menu.dismiss' | translate  }}</button>
          <button disabled mat-menu-item>{{ 'service.notification.menu.book_online' | translate  }}</button>
          <button disabled mat-menu-item>{{ 'service.notification.menu.book_offline' | translate  }}</button>
          <button disabled mat-menu-item [matMenuTriggerFor]="sendPushNotification">{{ 'service.notification.menu.send_notification' | translate  }}</button>
          <button disabled mat-menu-item [matMenuTriggerFor]="sendMessage">{{ 'service.notification.menu.send_message' | translate  }}</button>
          <button disabled mat-menu-item>{{ 'service.notification.menu.start_call' | translate  }}</button>
        </mat-menu>

        <mat-menu #sendPushNotification="matMenu" class="rounded-0">

        </mat-menu>

        <mat-menu #sendMessage="matMenu" class="rounded-0">

        </mat-menu>
      </button>
    </div>

    <div class="px-0 col-auto" style="padding-top: 4px;">
      <mat-form-field class="table-search border-02 row ml-4 pl-2">
        <mat-icon style="position: absolute; margin-top: -18px; color: #DDDDDD; bottom: 2px;">search</mat-icon>
        <input matInput class="border-0 outline-0 pl-4" type="text" (keyup)="devicesData.filter = $event.target.value.trim().toLowerCase()">
      </mat-form-field>
    </div>
  </div>
</div>

<div style="padding: 2px 34px 22px 34px;">
  <table mat-table [dataSource]="devicesData" class="w-100 custom-card table-hovered-row">
    <ng-container matColumnDef="checkbox">
      <th mat-header-cell *matHeaderCellDef class="pl-0 pt-1 text-center" style="width: 47px;">
        <div class="checkbox-count" [class.active]="activeDevices.length > 0" (click)="checkAll()">{{activeDevices.length}}</div>
      </th>
      <td mat-cell *matCellDef="let element" class="pl-0 pt-2 text-center" style="width: 47px;">
        <mat-checkbox class="m-1" (change)="onChangeCheckbox($event, element.id)"
                      [ngModel]="activeDevices.indexOf(element.id) !== -1"></mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="make">
      <th mat-header-cell *matHeaderCellDef style="width: 110px;">{{ 'service.table.make' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left" style="width: 110px;">{{element.make}}</td>
    </ng-container>

    <ng-container matColumnDef="model">
      <th mat-header-cell *matHeaderCellDef style="width: 100px;">{{ 'service.table.model' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left table-blue-text" style="width: 100px;">{{element.model}}</td>
    </ng-container>

    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef style="width: 70px;">{{ 'service.table.type' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left" style="width: 70px;">{{element.type}}</td>
    </ng-container>

    <ng-container matColumnDef="modification">
      <th mat-header-cell *matHeaderCellDef style="width: 130px;">{{ 'service.table.modification' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left" style="width: 130px;">{{element.modification}}</td>
    </ng-container>

    <ng-container matColumnDef="year">
      <th mat-header-cell *matHeaderCellDef style="width: 47px;">{{ 'service.table.year' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left" style="width: 47px;">{{element.fullYear}}</td>
    </ng-container>

    <ng-container matColumnDef="millage">
      <th mat-header-cell *matHeaderCellDef style="width: 60px;">{{ 'service.table.millage' | translate  }}</th>
      <td mat-cell *matCellDef="let element" class="text-left" style="width: 60px;">{{element.miliageString}}</td>
    </ng-container>

    <ng-container matColumnDef="RS">
      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef
          [class.d-none]="activeFilters.isRS" style="width: 50px;">RS</th>
      <td class="gray-table-cell" mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isRS" style="width: 50px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="getIsWarrantyError(element) === 2 &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="WE">
      <th mat-header-cell *matHeaderCellDef class="text-center" [class.d-none]="activeFilters.isWE" style="width: 52px;">WE</th>
      <td mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isWE" style="width: 52px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="getIsWarrantyError(element) === 1 &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="UE">
      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef
          [class.d-none]="activeFilters.isUE" style="width: 50px;">UE</th>
      <td class="gray-table-cell" mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isUE" style="width: 50px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="getIsError(element.data) &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="TP">
      <th mat-header-cell *matHeaderCellDef class="text-center" [class.d-none]="activeFilters.isTP" style="width: 54px;">TP</th>
      <td mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isTP" style="width: 54px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="element.data.TP > getConfig('TP', 'max') &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="CL">
      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef
          [class.d-none]="activeFilters.isCL" style="width: 50px;">CL</th>
      <td class="gray-table-cell" mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isCL" style="width: 50px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="element.data.CL > getConfig('CL', 'max') &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>
    <ng-container matColumnDef="OL">
      <th mat-header-cell *matHeaderCellDef class="text-center" [class.d-none]="activeFilters.isOL" style="width: 51px;">OL</th>
      <td mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isOL" style="width: 51px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="element.data.OL > getConfig('OL', 'max') &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="FL">
      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef
          [class.d-none]="activeFilters.isFL" style="width: 50px;">FL</th>
      <td class="gray-table-cell" mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isFL" style="width: 50px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="element.data.FL > getConfig('FL', 'max') &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="BV">
      <th mat-header-cell *matHeaderCellDef class="text-center" [class.d-none]="activeFilters.isBV" style="width: 51px;">BV</th>
      <td mat-cell *matCellDef="let element" [class.d-none]="activeFilters.isBV" style="width: 51px;">
        <img src="/assets/notifications/service_alert.svg" alt="" *ngIf="element.data.BV < getConfig('BV', 'min') &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="onlineService">
      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef [class.d-none]="activeFilters.onlineService"
          style="white-space: pre-wrap; width: 64px;">{{ 'service.notification.table.online_service' | translate }}</th>
      <td class="gray-table-cell" mat-cell *matCellDef="let element" [class.d-none]="activeFilters.onlineService" style="width: 64px;">
        <img src="/assets/notifications/online_service.svg" alt="" *ngIf="element.onlineService">
      </td>
    </ng-container>

<!--    <ng-container matColumnDef="offlineService">-->
<!--      <th class="gray-table-cell text-center" mat-header-cell *matHeaderCellDef>Offline<br/>service</th>-->
<!--      <td class="gray-table-cell" mat-cell *matCellDef="let element"></td>-->
<!--    </ng-container>-->

    <ng-container matColumnDef="dataUpdate">
      <th mat-header-cell *matHeaderCellDef class="pr-0 text-center"
          style="white-space: pre-wrap; width: 106px;">{{ 'service.notification.table.data_update' | translate }}</th>
      <td mat-cell *matCellDef="let element" class="pr-0" style="width: 106px;">
        <img src="/assets/notifications/service_warning.svg" alt="" *ngIf="getIsDataUpdateError(element) &&
            dismissNotifications.devices.indexOf(element.id) < 0">
      </td>
    </ng-container>

    <ng-container matColumnDef="fake">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element"></td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        [class.row-active]="activeDevices.indexOf(row.id) !== -1"></tr>
<!--    [class.d-none]="activeFilters.isTP && !(row.data.data.TP > getConfig('TP', 'max')) ||-->
<!--    activeFilters.isCL && !(row.data.data.CL > getConfig('CL', 'max')) ||-->
<!--    activeFilters.isOL && !(row.data.data.OL > getConfig('OL', 'max')) ||-->
<!--    activeFilters.isFL && !(row.data.data.FL > getConfig('FL', 'max')) ||-->
<!--    activeFilters.isBV && !(row.data.data.BV < getConfig('BV', 'min'))"-->
  </table>
</div>
